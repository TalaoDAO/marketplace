/*
  eslint
    indent: ["off", 2],
    eqeqeq: "warn",
    no-unused-vars: "warn",
    camelcase: "warn",
*/

function onClickBurgerMenuBtn () {
  var bm = document.querySelector('.region-burgermenu');
  if (bm) {
    bm.style.display = (bm.style.display != 'none' && bm.style.display != '') ? 'none' : 'block';
    if (bm.style.display != 'none' && bm.style.display != '') {
      document.body.onclick = onClickBody;
    } else {
      document.body.onclick = null;
    }
  }
}

function onClickBody (evt) {
    var elt = evt.target;
    while (elt != null) {
        if (elt.className.indexOf('region-burgermenu') != -1 || elt.className.indexOf('burger-menu-btn-container') != -1) {
            return;
        }
        elt = elt.parentElement;
    }
    // On est arrivé jusque ici donc on as pas cliqué dans le burger menu
    var bm = document.querySelector('.region-burgermenu');
    bm.style.display = 'none';
    document.body.onclick = null;
}

document.addEventListener('DOMContentLoaded', FileUpload, false);
// Init works on file upload change to update the text input associated with file name
function FileUpload () {
    var fileInputs  = document.querySelectorAll('.form-file');

    for (var idx in fileInputs) {
        if (fileInputs.hasOwnProperty(idx)) {
            var fi = fileInputs[idx];
            if ((typeof fi).toLowerCase() == 'object') {
                fi.addEventListener('change', function () {
                    var the_return = document.querySelector("[data-fileinputtext='" + this.id + "']");
                    the_return.value = this.files[0].name;
                });
            }
        }
    }
}

(function ($) {
  // @see http://stackoverflow.com/a/13203876
  $(document).ready(function () {
    $('#signIn').popover({
      content: function () {
        return $('#signInContent').html();
      },
      container: 'body'
    });
    $('#signUp').popover({
      content: function () {
        return $('#signUpContent').html();
      },
      container: 'body'
    });

    // Bootstrap tooltip
    // $('.help-tip').tooltip({
    //   html: true,
    // });

    // Stop video in modal when you close it
    $('#videoModal').on('hidden.bs.modal', function (e) {
      $('#videoModal iframe').attr('src', $('#videoModal iframe').attr('src'));
    });
  });
})(jQuery);

function debounce (func, wait, immediate) {
  var timeout;
  return function () {
    var context = this;
    var args = arguments;
    var later = function () {
      timeout = null;
      if (!immediate) func.apply(context, args);
    };
    var callNow = immediate && !timeout;
    clearTimeout(timeout);
    timeout = setTimeout(later, wait);
    if (callNow) func.apply(context, args);
  };
};

var shiftWindow = function () { scrollBy(0, -150); };
window.addEventListener('hashchange', shiftWindow);
function load () { if (window.location.hash) shiftWindow(); }

(function ($) {
    $(document).ready(function () {
        makeActive();
        $('input[type="radio"]').on('change', function () {
            makeActive();
        });
    });

    function makeActive () {
        $('input[type="radio"]').each(function () {
            if ($(this).prop('checked')) {
                $(this).closest('.form-type-radio').addClass('active');
            } else {
                $(this).closest('.form-type-radio').removeClass('active');
            }
        });
    }
})(jQuery);

Drupal.behaviors.emhlive = {
    attach: function (context, settings) {
        jQuery('.emhlive-slider', context).once().each(function () {
            var $slider = jQuery(this);

            $slider.slick({
                infinite: false,
                slidesToShow: 3,
                slidesToScroll: 1,
                appendArrows: $slider.siblings('.emhlive-arrows'),
                dots: true,
                appendDots: $slider.siblings('.emh-dots.above'),
                responsive: [{
                    breakpoint: 992,
                    settings: {
                        slidesToShow: 2
                        // appendDots: '.emhlive-dots.below',
                    }
                }, {
                    breakpoint: 600,
                    settings: {
                        slidesToShow: 1,
                        appendDots: $slider.siblings('.emh-dots.below')
                    }
                }]
            });
        });
    }
};

/**
 * @file
 */

(function ($) {

  Drupal.behaviors.emindhub_emh_homepage = {
    attach: function (context, settings) {
      // Normal JS in here. Use $() instead of jQuery(), like:
      $('.popup-closed').hide();

      // Sliders.
      $('.hp-testimonies').slick();
      // TODO fix tabs and sliders: https://github.com/kenwheeler/slick/issues/619#issuecomment-67228390
      $('.field-name-field-hp-how-need-slides .field-collection-container').slick();
      $('.field-name-field-hp-how-have-slides .field-collection-container').slick();

      // Animated Gif on hover.
      $(function () {
        $('.vocabulary-domaine img').each(function () {
          var src = $(this).attr('src');
          var gif = $(this).parent().attr("data-src");
          $(this).hover(function () {
            $(this).attr('src', gif);
          }, function () {
            $(this).attr('src', src);
          });
        });
      });

      // Change some classes.
      $('.hp-solutions .col-sm-9 .col-sm-3') .removeClass('col-sm-3').addClass('col-sm-4');
      $('.hp-solutions .col-sm-3 .col-sm-3') .removeClass('col-sm-3');
    }
  }
}(jQuery));

Drupal.behaviors.expertise = {
    attach: function (context, settings) {
        jQuery('.expertise-slider', context).once().each(function () {
            var $slider = jQuery(this);

            $slider.slick({
                infinite: false,
                arrows: false,
                slidesToShow: 4,
                slidesToScroll: 1,
                dots: true,
                appendDots: $slider.siblings('.emh-dots'),
                responsive: [{
                    breakpoint: 1200,
                    settings: {
                        slidesToShow: 3
                    }
                }, {
                    breakpoint: 992,
                    settings: {
                        slidesToShow: 2
                    }
                }, {
                    breakpoint: 767,
                    settings: {
                        slidesToShow: 2
                    }
                }, {
                    breakpoint: 600,
                    settings: {
                        slidesToShow: 1
                    }
                }]
            });
        });
    }
};

Drupal.behaviors.faq = {
    attach: function (context, settings) {
        jQuery('.emh-module.faq', context).once(function (e) {
            var $this = jQuery(this);

            /**
             * Initialy close all answers
             */
            $this.find('.answer').hide();

            /**
             * Add click event to questions
             */
            $this.find('.question').on('click', function () {
                jQuery(this).next().slideToggle().siblings('.answer').slideUp();
                jQuery(this).toggleClass('active').siblings('.question').removeClass('active');
            });
        });
    }
};

Drupal.behaviors.hiwTabs = {
    attach: function (context, settings) {
        jQuery('.hiw-tabs', context).once().on('click', 'button', function (e) {
            var $this = jQuery(this);
            jQuery('.' + $this.data('tab')).removeClass('hiw-hidden').siblings('.hiw-tab-content').addClass('hiw-hidden');
            jQuery('.hiw-tabs .active').removeClass('active');
            $this.addClass('active');
        });

        jQuery('.hiw-tabs', context).find('button').first().trigger('click');
    }
};

Drupal.behaviors.publications = {
    attach: function (context, settings) {
        jQuery('.publications-slider', context).once().each(function () {
            var $slider = jQuery(this);

            $slider.slick({
                arrows: false,
                dots: true,
                slidesToShow: 5,
                slidesToScroll: 1,
                infinite: false,
                appendDots: $slider.siblings('.emh-dots'),
                responsive: [
                    {
                        breakpoint: 992,
                        settings: {
                            slidesToShow: 4
                        }
                    },
                    {
                        breakpoint: 768,
                        settings: {
                            slidesToShow: 3
                        }
                    },
                    {
                        breakpoint: 600,
                        settings: {
                            slidesToShow: 2
                        }
                    },
                    {
                        breakpoint: 480,
                        settings: {
                            slidesToShow: 1
                        }
                    }
                ]
            });
        });
    }
};

Drupal.behaviors.references = {
    attach: function (context, settings) {
        jQuery('.references-list', context).once().each(function () {
            var $slider = jQuery(this);

            $slider.slick({
                arrows: true,
                dots: false,
                slidesToShow: 5,
                slidesToScroll: 1,
                infinite: false,
                responsive: [{
                    breakpoint: 768,
                    settings: {
                        slidesToShow: 2,
                        slidesToScroll: 1
                    }
                }, {
                    breakpoint: 480,
                    settings: {
                        infinite: true,
                        slidesToShow: 1,
                        slidesToScroll: 1
                    }
                }]
            });
        });
    }
};

Drupal.behaviors.requests = {
    attach: function (context, settings) {
        jQuery('.requests-slider', context).once().each(function () {
            var $slider = jQuery(this);

            var requestsSliderOptions = {
                arrows: false,
                dots: true,
                slidesToShow: 2,
                slidesToScroll: 2,
                infinite: true,
                appendDots: $slider.siblings('.emh-dots'),
                responsive: [
                    {
                        breakpoint: 600,
                        settings: {
                            slidesToShow: 1,
                            slidesToScroll: 1
                        }
                    }
                ]
            };

            /**
             * Debounce postpone execution on event trigger stop
             * then enable slider only if width <= 800
             */
            var checkRequestsSlick = debounce(function () {
                if (document.body.clientWidth > 800) {
                    $slider.find('.row.slick-initialized').slick('unslick');
                } else {
                    $slider.find('.row:not(.slick-initialized)').slick(requestsSliderOptions);
                }
            }, 300);

            checkRequestsSlick();
            window.addEventListener('resize', checkRequestsSlick);
        });
    }
};

Drupal.behaviors.testimonials = {
    attach: function (context, settings) {
        /**
         * Manage each slider individualy
         */
        jQuery('.testimonial-slider', context).once().each(function () {
            var $slider = jQuery(this);

            /**
             * Init slider
             */
            $slider.slick({
                infinite: false,
                slidesToShow: 1,
                slidesToScroll: 1,
                arrows: false,
                dots: false,
                vertical: true
            });

            /**
             * Refresh slider on window resize
             */
            window.addEventListener('resize', debounce(function () {
                $slider.slick('refresh');
            }, 300));

            /**
             * Switch slider active item when using tabs
             */
            $slider.siblings('.testimonial-tabs').on('click', 'li', function (e) {
                var $this = jQuery(this);
                $slider.slick('slickGoTo', $this.index());
                $this.addClass('active').siblings().removeClass('active');
            });
        });
    }
};
